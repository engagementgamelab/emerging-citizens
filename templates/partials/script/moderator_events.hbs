{{!< default}}
{{!-- 
/**
 * Emerging Citizens
 * Developed by Engagement Lab, 2016
 * ==============
 * 
 * Script includes partial for MODERATOR socket.io events
 * ==========
 */
--}}			

var socketEvents = function(eventId, eventData) {
		
	var currentPlayers = [];

    switch (eventId) {

        case 'connect':

			   // Connected, let's sign-up for to receive messages for this room
			   socket.emit('room', emitData('moderator'));
               
            break;

        case 'players:update':

                var staticPlayers = $('.player-static');
			  	currentPlayers = _.pluck(eventData, 'username');
	
    		    // $('#playersContent').html(currentPlayers.join('<p> joined. </p><br />'));

                _.each(currentPlayers, function(name, index) {

                    var nameFormatted = (name.length <= 15) ? name : name.substring(0, 15) + "...";

                    $(staticPlayers[index]).children('.icon').addClass('active');
                    $(staticPlayers[index]).children('.nameplate').addClass('active').text(nameFormatted);
                });

            break;
            
        case 'game:countdown':

            /*var minutes = Math.floor(eventData / 60);
            var seconds = eventData - minutes * 60;*/

            console.log('countdown' , eventData)

            var clock = $('#countdownTimer').FlipClock(eventData, {
                clockFace: 'MinuteCounter',
                countdown: true
            });

            break;


        case 'game:start':

            

        case 'game:end':
        case 'hashtag:submitted':
        case 'hashtags:received':

            $('#gameContent').html(eventData);

            break;

        case 'hashtags:reveal':

            $('#gameContent').html(eventData);

            //instantiate a TimelineLite for hashtags animation
            var hashtagsAnim = new TimelineLite({ paused:true, onComplete:function() { showReal(); }});
            var realHashtagAnim = new TimelineLite({ paused:true, onComplete:function() { showScore(); }});
            var scoreAnim = new TimelineLite();

            var elements = $('#hashtag-results .result.fake');
            
            // 1) Show hashtags
            hashtagsAnim.from($('#hashtags'), 1.5, {top:-200, autoAlpha:0, ease:Bounce.easeOut});
            
            _.each(elements, function(el, index) {

                hashtagsAnim.from(el, 1, {y:-200, autoAlpha:0, ease:Bounce.easeOut})
                .staggerFrom($(el).find('.voter'), 3, {scale:0, opacity:0, ease:Elastic.easeOut, onStart: function() {

                        ion.sound.play("button_tiny");

                }}, 2)
                .to(el, 1, {delay: 5, y:200, autoAlpha:0, display:'none'});

            });
            hashtagsAnim.play();

            function showReal() {

                realHashtagAnim
                .from($('#hashtag-submissions-prompt'), 1, {y:-45, autoAlpha:0})
                .from($('#hashtag-results .result.real'), 1, {delay: 0.5, y:-200, autoAlpha:0, ease:Bounce.easeOut})
                .to($('#hashtags'), 1, {delay: 5, y:-200, autoAlpha:0, display:'none', ease:Elastic.easeIn});

                realHashtagAnim.play();

            }

            function showScore() {

                scoreAnim.from($('#scores'), 1.5, {scale:0.5, autoAlpha:0, ease:Bounce.easeOut});
                scoreAnim.play();

            }

            // $('#countdownTimer').hide();

            break;

    }
    
};