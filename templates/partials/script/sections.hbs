{{!< default}}
{{!-- 
/**
 * Emerging Citizens
 * Developed by Engagement Lab, 2016
 * ==============
 * 
 * Script includes partial for individual sections
 * ==========
 */
--}}

<script type="text/javascript">

	// For socket debugging
	localStorage.debug = '*';

  // All possible socket event IDs
	var eventIds = [

		'connect',
		'players:update',
		'game:start',
		'game:end',
		'game:notfound',
		'game:countdown',
		'hashtag:submitted',
		'hashtags:received',
		'hashtags:reveal'
	
	];

	$(document).ready(function() {
			
		// Open socket connection
    socket = io();
		
		{{!-- INDEX Template Script --}}
		{{#ifeq section 'home'}}
    
		  var gameCode = '{{game.accessCode}}';
	
			// Load events for players
			{{> script/player_events}}

			/**
			 * Listen for forms that dispatch socket events.
			 *
			 * ### Examples:
			 *
			 * @class sections
			 */
			$(document).on('click', '.input-box :submit', function() {
				
				var event = $(this).data().event;
				var pkg = $(this).data().package;

				if($.isPlainObject(pkg)) {
					$.each(Object.keys(pkg), function( key, value ) {
					  pkg[value] = $(pkg[value].toString()).val();
					});
				}
				else
					pkg = $(pkg).val()
				
				socket.emit(event, emitData(pkg));

				$('#submission').hide();
				$('#submitted').show();

			});

		{{/ifeq}}

		{{#ifeq section 'moderator'}}

			$('#btn_submit').click(function(e) {
				var data = $(":input").serializeArray();
				console.log(data);
			  $.post( 
			  	"/api/create/",
					data,
					function( data ) {
					  window.location = data;
					}
				);
			});

		{{/ifeq}}

		{{#ifeq section 'moderator/monitor'}}
		
			var gameCode = '{{game.accessCode}}-moderator';

			// Load events for moderators
			{{> script/moderator_events}}
		
		{{/ifeq}}

		$.each(eventIds, function(index, id) {
		  
		  socket.on(id, function(eventData) {

				console.log("EVENT ID: ", id);
				console.log("EVENT DATA: (" + eventData + ")");

			 	socketEvents(id, eventData); 
			});

		});
		
		function emitData(data) {
			return { gameId: gameCode, msgData: data };
		}
		
});

</script>