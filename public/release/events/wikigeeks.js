"use strict";var playerWasReconnected,retrievingData,random;"none"!==$(".article-error").css("display")&&setTimeout($(".article-error").hide(),5e3),$(".body").addClass("wikigeeks");var gameEvents=function(a,b){var c,d="https://en.wikipedia.org/w/api.php?callback=?",e=function(a){$(c).find(a).remove()},f=function(a,b,c){if(retrievingData!==!0){var e=d+"&action=parse&format=json&redirects&page="+a;sessionStorage.setItem("currentArticle",a);var f=(String(a),$(".article-name"));f.text(a),retrievingData=!0,$.getJSON(e,function(d){if(d.error){var e="Looks like there's something up with that link/article...<br />Try a different one!";$(".error").html(e).fadeIn();var f=$("#btn_search");return f.find("img").fadeOut(150,function(){f.find("span").fadeIn(150)}),f.removeAttr("disabled"),void(retrievingData=!1)}0!==d.parse.redirects.length&&(a=d.parse.redirects[0].to),g(d),c?c&&$("#topic-submission").fadeOut(function(){$("section#submitted").hide(),$("#wiki-article").fadeIn(),$("section#article").show()}):socket.emit("article:select",emitData({title:a,initial:b})),random?$("#article .article-name").html("Our random article generator sent you to<br />"+a):$("#article .article-name").html(a),retrievingData=!1,random=!1})}},g=function(a){var b=a.parse.text["*"];c=$("#wiki-workspace"),$(c).html(b);var d=$(window).width();$("section#article").width(d),$("table").css({"max-width":d,width:"100%","font-size":".9em","word-break":"break-word"}),$("ul.gallery").css({"list-style":"none",padding:"0"}),$(".thumbinner").css({width:"auto","max-width":d-50}),$(".thumbinner img").css({width:"auto","max-width":d-100}),$("img").css({width:"auto","max-width":d-100,margin:"0 auto"}),$(".gallerytext").css("text-align","center"),$("table img").css("display","none"),$("a.image img").css({margin:"0 auto"}),$("table, table.infobox, .thumbinner").css({margin:"0 auto","float":"none"}),$("table:not(:has(table))").css({"margin-top":"5%","margin-bottom":"5%"}),$("table tr:not(:has(tr)), table th:not(:has(th)), table td:not(:has(td))").css({border:"1px solid #36d5d9",padding:"2px"}),$("table.infobox td, .infobox th, .thumbinner").css("padding","1px"),$(".nowraplinks, .nowraplinks tr").css("border","1px solid #36d5d9"),$(".nowraplinks th").css("padding","8px"),$("table.rquote").css("width","100%"),$("table.metadata").css("border","none"),$(".thumb").css({border:"1px solid","background-color":"#e6e6e6",margin:"2%"}),$(".thumbinner").css("padding","2%"),$("div:has(>.wikitable)").css({width:"100%",display:"block"}),e("table.metadata td:has(img)"),e(".mbox-image"),e(".tocnumber"),e(".mw-editsection"),e(".plainlinks.hlist.navbar.mini"),e("span.flagicon"),e(".metadata .image"),e("div#toc"),e(".references"),e("sup"),$("li").css("text-align","left"),$("li.gallerybox").css("width","100%"),$("li.gallerybox div:first-child").css("width","100%"),$("span#See_also").parent().nextAll().remove(),$("span#See_also").parent().remove(),$("#wiki-content").html($(c).clone().html()).find("a").click(function(a){a.preventDefault();var b=$(a.currentTarget).data().title;f(b,!1)}).each(function(a,b){$(b).data({title:$(b).attr("href").replace("/wiki/","")}),$(b).hasClass("new")&&$(b).attr("href","javascript:void(0)").attr("disabled","disabled")}),window.scrollTo(0,0),$(c).empty()};switch(a){case"game:start":sessionStorage.currentArticle&&playerWasReconnected&&f(sessionStorage.currentArticle,!1,!0);var h=$("#article_input");-1!==location.href.indexOf("debug")&&$.getJSON(d+"&action=query&format=json&list=random&rnnamespace=0&rnfilterredir=nonredirects&rnlimit=1",function(a){h.val(a.query.random[0].title)}),$("button#clear").click(function(){h.val(""),$(this).addClass("hidden"),$(".submission .form").removeClass("moveUp")}),$("#btn_search").click(function(a){var b=$(a.currentTarget);b.find("span").fadeOut(150,function(){b.find("img").fadeIn(150,function(){f(h.val(),!0)})}),b.attr("disabled","disabled")}),h.autocomplete({source:function(a,b){$.ajax({url:"https://en.wikipedia.org/w/api.php",dataType:"jsonp",data:{action:"opensearch",format:"json",search:a.term},success:function(a){b(a[1])}})},select:function(a,b){$("button#clear").removeClass("hidden"),$(".submission .form").addClass("moveUp")}}),h.keypress(function(a){$(a.currentTarget).removeClass("invalid"),$(".error").fadeOut(250)});break;case"article:tryagain":$(".error").text(b).fadeIn();break;case"article:valid":b.initial&&$("#topic-submission").fadeOut(function(){$("section#submitted").fadeIn(),$("#wiki-article").fadeIn()});break;case"article:random":random=!0,f(b,!1,!0);break;case"wiki:results":updateGameContent(b);var i=500,j=0,k=$("#firstArticle"),l=$(".articleGroup");$(k).css({transform:"scale(1)"}),$.each(l,function(a,b){var c=$(b).find(".articleDot"),d=$(b).find(".articleLine"),e=$(b).find(".articleText"),f=i+j;$(c[0]).delay(f).velocity({r:10},i,[50,10]),$(d).delay(500+f).velocity({y2:50},i,[50,10]),$(c[1]).delay(1e3+f).velocity({r:10},i,[50,10]),setTimeout(function(){$(e).css({transform:"scale(1)"})},1500+f),j=5*i*a,$("#survey-ready").click(function(){$(".results-container").fadeOut(),$(".typeform").fadeIn()})});break;case"topic:info":$(".timesUp").hide(),$("input").disabled=!1;var m=function(){"none"!==$("section#submitted").css("display")?$("section#submitted").hide():clearInterval(n)};$("#wiki-article").show(),$("section#article").show(),$("section#submitted").hide();var n=setInterval(function(){m()},1e3);break;case"player:reconnected":playerWasReconnected=!0;break;case"game:countdown_ending":void 0!==sessionStorage.currentArticle&&playerWasReconnected===!0&&socket.emit("game:start",{gameId:sessionStorage.gameCode}),"none"!==$("#topic-submission").css("display")&&$(".form .error").text(b+"If you haven't found a starting article soon, we will choose one for you..");break;case"game:countdown_end":$("input").disabled=!1,"none"===$("#submitted").css("display")?($("input").disabled=!0,$(".timesUp").html("<span>Time is up! Sending you to a random article...</span>"),$(".timesUp").show(),$("#topic-submission").hide()):"none"!==$("section#submitted").css("display")&&($("input").disabled=!0,$(".timesUp").html("<span>Time is up! Sending you to your starting article...</span>"),$(".timesUp").show(),$("section#submitted").hide())}};